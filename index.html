<html>
	<head>
		<title>Tchat lite</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	</head>
	<body>
		<h1>Chat lite</h1>
		<form id="form" method="post">
			<table>
				<tr>
					<td>Pseudo:</td>
					<td><input type="text" name="pseudo" id="pseudo">
				</tr>
				<tr>
					<td>Message</td>
					<td><input type="text" name="message" id="message">
				</tr>
				<tr>
					<td colspan="2"><input type="submit" name="submit" value="Envoyer"></td>
				</tr>
			</table>
		<form>
		<table class="list-message"></table>

		<script>

			var data = getData();

			setDataToTable(data);

			function setDataToTable(data) {
				
				data.map(function(element){
					appendTable(element.pseudo, element.message);
				});
			}

			function appendTable(pseudo, message) {
				var tableMessage = $(".list-message");
				content = '<tr><td>Pseudo:'+ pseudo +'<br> message '+ message +'</td></tr>';
				tableMessage.append(content);
			}

			function getData() {
				return JSON.parse(localStorage.getItem("messages"));
			}

			function setData(data) {
				localStorage.setItem("messages", JSON.stringify(data));
			}

			function addItemData(pseudo, message) {
				var item = {
					"pseudo": pseudo,
					"message": message
				}
				var dataTemp = getData();
				dataTemp.push(item);
				setData(dataTemp);
				appendTable(pseudo, message);
			}

			$("#form").submit(function() {
				var pseudo = $("#pseudo").val();
				var message = $("#message").val();
				addItemData(pseudo, message);
			});
		</script>
	</body>
</html>